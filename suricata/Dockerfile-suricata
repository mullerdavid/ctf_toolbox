FROM jasonish/suricata

# Add new entrypoint
COPY start-suricata.sh /start-suricata.sh

# Install Arkime
RUN curl https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 --output /opt/yq && \
    chmod +x /opt/yq && \
    /opt/yq -i 'del(.af-packet) | .default-rule-path = "/var/lib/suricata/rules/"' /etc/suricata/suricata.yaml && \
    suricata-update update-sources && \
    suricata-update enable-source et/open && \
    suricata-update enable-source oisf/trafficid && \
    suricata-update enable-source tgreen/hunting && \
    suricata-update enable-source malsilo/win-malware && \
    suricata-update enable-source stamus/lateral && \
    suricata-update && \
    chmod 755 /start-suricata.sh && \
    mkdir -p /data && \
    mkdir -p /eve

VOLUME ["/data", "/eve"]

ENTRYPOINT ["/start-suricata.sh"]
