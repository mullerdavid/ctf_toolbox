FROM jasonish/suricata

# Add new entrypoint
COPY start-suricata.sh /start-suricata.sh

# Install Arkime
RUN wget https://github.com/mikefarah/yq/releases/latest/download/yq_linux_$(dpkg --print-architecture) -O /opt/bin/yq && \
    chmod +x /opt/bin/yq && \
    /opt/bin/yq -i 'del(.af-packet) | .default-rule-path = "/var/lib/suricata/rules/"' /etc/suricata/suricata.yaml
    suricata-update update-sources && \
    suricata-update enable-source et/open && \
    suricata-update enable-source oisf/trafficid && \
    suricata-update enable-source tgreen/hunting && \
    suricata-update enable-source malsilo/win-malware && \
    suricata-update enable-source stamus/lateral && \
    suricata-update
    chmod 755 /start-arkimeviewer.sh && \
    mkdir -p /data && \

VOLUME ["/data"]

ENTRYPOINT ["/start-arkimeviewer.sh"]
